pkgname=hdhomerun
version=20230323
revision=1
build_style=gnu-makefile
hostmakedepends="gcc make"
makedepends=""
short_desc="Silicon Dust HDHomeRun configuration utility"
maintainer="Bob Hepple <bob.hepple@gmail.com>"
license="GPL-2.0-only"
homepage="http://www.silicondust.com"
distfiles="http://download.silicondust.com/hdhomerun/libhdhomerun_${version}.tgz"
checksum=4f599c4f774c7accfc78fe07a2d492f2352c7b5ed9aa03f39b74f39c937b96e6

post_extract() {
	sed -i 's/\r//' *
	sed -i -e '/$(STRIP).*/d' -e 's/C\(PP\)\?FLAGS .=/C\1FLAGS ?=/' Makefile
	for f in *; do
		/usr/bin/iconv -f iso-8859-1 -t utf-8 --output $f.new $f && mv $f.new $f
	done
}

do_build() {
	make
}

do_install() {
	vmkdir /usr/lib
	vbin hdhomerun_config
	vlicense LICENSE
	vdoc README.md
}

hdhomerun-devel_package() {
	short_desc+=" - development files"
	depends="${sourcepkg}>=${version}_${revision}"
	pkg_install() {
		vinstall libhdhomerun.so 644 "usr/lib"
                for i in hdhomerun*.h; do
		    vinstall $i 644 "usr/include"
                done
	}
}
